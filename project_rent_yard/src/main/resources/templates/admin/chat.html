<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin Chat</title>

    <th:block th:replace="layout/layout :: library"></th:block>

    <style>
        #chat-box {
            height: 400px;
            border: 1px solid #ccc;
            padding: 10px;
            overflow-y: auto;
            background: #f9f9f9;
        }

        .user {
            text-align: left;
            margin: 6px 0;
        }

        .admin {
            text-align: right;
            margin: 6px 0;
        }

        .bubble {
            display: inline-block;
            padding: 8px 12px;
            border-radius: 12px;
            max-width: 70%;
            word-break: break-word;
        }

        .user .bubble {
            background: #e9ecef;
            color: #000;
        }

        .admin .bubble {
            background: #0d6efd;
            color: #fff;
        }
    </style>
</head>

<body>

<div class="container mt-4">
    <h3>üí¨ Admin Support Chat</h3>

    <div id="current-user"
         style="margin-bottom:10px; font-weight:bold;">
        ƒêang chat v·ªõi:
        <span th:text="${session.user?.name}">---</span>
    </div>


    <div id="chat-box"></div>

    <div class="input-group mt-3">
        <input id="message"
               type="text"
               class="form-control"
               placeholder="Nh·∫≠p tin nh·∫Øn...">
        <button class="btn btn-primary" onclick="sendMessage()">G·ª≠i</button>
    </div>
</div>

<script src="http://localhost:3000/socket.io/socket.io.js"></script>
<script>
    const socket = io("http://localhost:3000");

    socket.on("message", (content) => {
        showMessage(content, "user");
    });

    function sendMessage() {
        const input = document.getElementById("message");
        const content = input.value.trim();
        if (!content) return;

        showMessage(content, "admin");
        socket.emit("message", content);

        input.value = "";
    }

    function showMessage(content, role) {
        const chatBox = document.getElementById("chat-box");

        const wrapper = document.createElement("div");
        wrapper.className = role;

        const bubble = document.createElement("div");
        bubble.className = "bubble";
        bubble.innerText = content;

        wrapper.appendChild(bubble);
        chatBox.appendChild(wrapper);

        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>

</body>
</html>
